<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelForge - Art & Music</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/nes.css@2.3.0/css/nes.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        body {
            background-color: #212529;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            padding-bottom: 50px;
        }
        .container { max-width: 980px; margin: 0 auto; padding: 20px; }
        
        /* 头部样式 */
        header { text-align: center; margin: 30px 0; color: #20c997; }
        .logo-text { text-shadow: 4px 4px 0px #000; margin-bottom: 10px; }
        
        /* 选项卡切换器 */
        .mode-switcher {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: -4px; /* 让按钮贴合下方的容器 */
            position: relative;
            z-index: 10;
        }
        .mode-btn { width: 180px; }

        /* 控制面板 */
        .control-panel {
            background-color: #fff;
            color: #000;
            margin-bottom: 40px;
            border-top-left-radius: 0; /* 配合选项卡视觉 */
            border-top-right-radius: 0;
        }

        .input-row { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
        .flex-grow { flex-grow: 1; }

        /* 图片结果 */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }
        .pixel-art-img {
            width: 100%; height: 220px; object-fit: contain;
            background-color: #000;
            image-rendering: pixelated; 
            border-bottom: 4px solid #000;
        }

        /* 音乐结果 (卡带样式) */
        .music-list { display: flex; flex-direction: column; gap: 15px; }
        .cassette-tape {
            background: #3e4246;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 4px solid #fff;
        }
        .cassette-info { flex-grow: 1; }
        .audio-player { width: 100%; height: 30px; margin-top: 10px; }

        .loading-overlay { text-align: center; padding: 40px; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

<div id="app" class="container">
    
    <header>
        <h1 class="logo-text"><i class="nes-icon star is-medium"></i> PixelForge</h1>
        <p>AI Asset Generator for Indie Devs</p>
    </header>

    <div class="mode-switcher">
        <button class="nes-btn mode-btn" 
            :class="currentMode === 'art' ? 'is-primary' : ''" 
            @click="currentMode = 'art'">
            Graphics
        </button>
        <button class="nes-btn mode-btn" 
            :class="currentMode === 'music' ? 'is-warning' : ''" 
            @click="currentMode = 'music'">
            Music
        </button>
    </div>

    <section class="nes-container with-title is-dark" style="margin-top: 0;">
        <p class="title">{{ currentMode === 'art' ? 'Pixel Art Studio' : 'Chiptune Synthesizer' }}</p>
        
        <div v-if="currentMode === 'art'">
            <div class="field">
                <label>Visual Description:</label>
                <textarea class="nes-textarea" v-model="art.prompt" placeholder="e.g. A treasure chest in a dark dungeon..."></textarea>
            </div>
            <div class="input-row">
                <div class="nes-select is-dark flex-grow">
                    <select v-model="art.style">
                        <option value="16bit">16-Bit Style</option>
                        <option value="8bit">8-Bit Style</option>
                        <option value="gb">GameBoy Green</option>
                    </select>
                </div>
                <div class="nes-select is-dark flex-grow">
                    <select v-model="art.type">
                        <option value="character">Character</option>
                        <option value="tileset">Tileset</option>
                        <option value="ui">UI Element</option>
                    </select>
                </div>
            </div>
        </div>

        <div v-if="currentMode === 'music'">
            <div class="field">
                <label>Vibe & Scenario:</label>
                <textarea class="nes-textarea" v-model="music.prompt" placeholder="e.g. Fast paced boss battle, intense, loopable..."></textarea>
            </div>
            <div class="input-row">
                <div class="nes-select is-dark flex-grow">
                    <select v-model="music.mood">
                        <option value="adventure">Adventure / Heroic</option>
                        <option value="dungeon">Dark / Dungeon</option>
                        <option value="chill">Town / Chill</option>
                        <option value="battle">Battle / Boss</option>
                    </select>
                </div>
                <div class="nes-select is-dark flex-grow">
                    <select v-model="music.duration">
                        <option value="15">Short Loop (15s)</option>
                        <option value="30">Medium Loop (30s)</option>
                        <option value="60">Full Track (1m)</option>
                    </select>
                </div>
            </div>
        </div>

        <div style="margin-top: 30px; text-align: right;">
            <button type="button" class="nes-btn" 
                :class="currentMode === 'art' ? 'is-primary' : 'is-warning'"
                @click="generate" 
                :disabled="isGenerating">
                {{ isGenerating ? 'Generating...' : (currentMode === 'art' ? 'RENDER PIXELS >' : 'SYNTHESIZE AUDIO >') }}
            </button>
        </div>
    </section>

    <div v-if="isGenerating" class="loading-overlay">
        <p>{{ currentMode === 'art' ? 'Painting pixels...' : 'Composing chiptunes...' }}</p>
        <progress class="nes-progress is-pattern" value="50" max="100"></progress>
    </div>

    <hr style="border-top: 4px dashed #555; margin: 40px 0;">

    <section v-if="currentMode === 'art' && art.results.length > 0">
        <h3 class="title" style="margin-bottom: 20px; color:#20c997">Generated Sprites</h3>
        <div class="results-grid">
            <div class="nes-container is-rounded is-dark" style="padding:0;" v-for="(img, idx) in art.results" :key="idx">
                <img :src="img.url" class="pixel-art-img">
                <div style="padding: 10px; text-align:center;">
                    <button class="nes-btn is-small">Download PNG</button>
                </div>
            </div>
        </div>
    </section>

    <section v-if="currentMode === 'music' && music.results.length > 0">
        <h3 class="title" style="margin-bottom: 20px; color:#f7d51d">Generated Audio Tracks</h3>
        <div class="music-list">
            <div class="cassette-tape" v-for="(track, idx) in music.results" :key="idx">
                <i class="nes-icon coin is-large"></i>
                <div class="cassette-info">
                    <p style="margin-bottom: 5px; color: #f7d51d;">Track #00{{ idx + 1 }}: {{ track.title }}</p>
                    <span class="nes-text is-disabled" style="font-size: 0.8em;">{{ track.duration }}s | 8-Bit | Loopable</span>
                    <audio controls class="audio-player">
                        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                </div>
                <button class="nes-btn is-error">Save .WAV</button>
            </div>
        </div>
    </section>

</div>

<script>
    const { createApp } = Vue

    createApp({
        data() {
            return {
                currentMode: 'art', // 'art' 或 'music'
                isGenerating: false,
                
                // 美术数据
                art: {
                    prompt: '',
                    style: '16bit',
                    type: 'character',
                    results: []
                },

                // 音乐数据
                music: {
                    prompt: '',
                    mood: 'adventure',
                    duration: '15',
                    results: []
                }
            }
        },
        methods: {
            generate() {
                // 简单验证
                const currentPrompt = this.currentMode === 'art' ? this.art.prompt : this.music.prompt;
                if (!currentPrompt) {
                    alert("Please enter a description!");
                    return;
                }

                this.isGenerating = true;

                // 模拟 API 请求
                setTimeout(() => {
                    this.isGenerating = false;

                    if (this.currentMode === 'art') {
                        // 模拟生成图片
                        const seed = Math.random().toString(36).substring(7);
                        // 清空旧结果并添加新结果（或者你可以选择追加）
                        this.art.results = [
                            { url: `https://robohash.org/${seed}1?set=set2&size=200x200` },
                            { url: `https://robohash.org/${seed}2?set=set2&size=200x200` },
                            { url: `https://robohash.org/${seed}3?set=set2&size=200x200` }
                        ];
                    } else {
                        // 模拟生成音乐
                        // 注意：这里的音频 src 只是一个在线测试音频，真实后端需要返回生成的 .wav/.mp3 文件链接
                        this.music.results.unshift({ // 将新生成的放在最上面
                            title: this.music.prompt.substring(0, 15) + "...", 
                            duration: this.music.duration
                        });
                    }
                }, 2000);
            }
        }
    }).mount('#app')
</script>

</body>
</html>